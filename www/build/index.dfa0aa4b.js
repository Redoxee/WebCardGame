class t{constructor(t,e){null===t?(this.x=0,this.y=0):(this.x=t,this.y=e)}clone(){return new t(this.x,this.y)}toString(){return`(${this.x}, ${this.y})`}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}normalize(){let t=this.length();return this.x=this.x/t,this.y=this.y/t,this}norm(){let e=this.length();return new t(this.x/e,this.y/e)}scale(e){return new t(this.x*e,this.y*e)}static dot(t,e){return t.x*e.x+t.y*e.y}static cross(t,n){return new e(0,0,t.x*n.y-t.y*n.x)}static add(e,n){return new t(e.x+n.x,e.y+n.y)}static sub(e,n){return new t(e.x-n.x,e.y-n.y)}static equal(t,e){return t.x===e.x&&t.y===e.y}}t.Zero=new t(0,0),t.Up=new t(0,1),t.Right=new t(1,0);class e{constructor(t,e,n){null===t?(this.x=0,this.y=0,this.z=0):(this.x=t,this.y=e,this.z=n)}toString(){return`(${this.x}, ${this.y}, ${this.z})`}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}normalize(){let t=this.length();return this.x=this.x/t,this.y=this.y/t,this.z=this.z/t,this}norm(){let t=this.length();return new e(this.x/t,this.y/t,this.z/t)}scale(t){return new e(this.x*t,this.y*t,this.z*t)}static dot(t,e){return t.x*e.x+t.y*e.y+t.z*e.z}static cross(t,n){return new e(t.y*n.z-t.z*n.y,t.z*n.x-t.x*n.z,t.x*n.y-t.y*n.x)}static add(t,n){return new e(t.x+n.x,t.y+n.y,t.z+n.z)}static sub(t,n){return new e(t.x-n.x,t.y-n.y,t.z-n.z)}static equal(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z}}e.Zero=new e(0,0,0),e.Up=new e(0,1,0),e.Down=new e(0,-1,0),e.Left=new e(-1,0,0),e.Right=new e(1,0,0),e.Forward=new e(0,0,-1),e.Backward=new e(0,0,1);let n=1;function i(){let t=`id-${n.toString(16)}`;return n+=1,t}function s(t){let e=`${t.className}-${i()}`;var n=document.createElement("style");return n.type="text/css",n.innerHTML=`${t.className?`.${e}`:""} ${t.id?`#${t.id}`:""} { ${t.content} }`,document.getElementsByTagName("head")[0].appendChild(n),e}class r{constructor(e){let n=e.getBoundingClientRect();this.targetElement=e,this.top=n.top+window.pageYOffset,this.right=n.right+window.pageXOffset,this.bottom=n.bottom+window.pageYOffset,this.left=n.left+window.pageXOffset,this.centerPosition=new t(n.left+window.pageXOffset+(n.right-n.left)/2,n.top+window.pageYOffset+(n.bottom-n.top)/2),this.width=n.right-n.left,this.height=n.top-n.bottom}Recompute(){let t=this.targetElement.getBoundingClientRect();this.top=t.top+window.pageYOffset,this.right=t.right+window.pageXOffset,this.bottom=t.bottom+window.pageYOffset,this.left=t.left+window.pageXOffset,this.centerPosition.x=t.left+window.pageXOffset+(t.right-t.left)/2,this.centerPosition.y=t.top+window.pageYOffset+(t.bottom-t.top)/2,this.width=t.right-t.left,this.height=t.top-t.bottom}Contains(t){return t.x>this.left&&t.x<this.right&&t.y>this.top&&t.y<this.bottom}}class o{}o.EaseInOut={p1x:.32,p1y:0,p2x:.5,p2y:1},o.Linear={p1x:.32,p1y:.32,p2x:.75,p2y:.75},o.DefaultBezierParams={p1x:.5,p1y:.5,p2x:.5,p2y:.5};let a=0,l=0;const d=[];!function t(e){let n=performance.now();l=n-a,a=n,d.forEach(t=>{t.animationFrame(l)}),requestAnimationFrame(t)}(performance.now());class h{constructor(e,n){this.target=e,this.rotationFactor=n,this.duration=0,this.p0=t.Zero.clone(),this.p1=t.Zero.clone(),this.travel=t.Zero.clone(),this.endTime=0,this.elapsedTime=0,this.startTime=-1,this.bezierParams=o.DefaultBezierParams,this.direction=t.Zero.clone(),this.id=i(),this.startEvent=new CustomEvent("cardAnimationStart"),this.endEvent=new CustomEvent("cardAnimationEnd")}startAnimation(e,n,i,s){this.p0=e.clone(),this.p1=n.clone();let r=t.sub(n,e).length();this.duration=r/i,this.startTime=performance.now()-l,this.endTime=this.startTime+this.duration,this.elapsedTime=0,this.travel=t.sub(n,e),this.direction=this.travel.norm(),this.bezierParams=s,d.find(t=>t.id===this.id)||d.push(this),this.target.dispatchEvent(this.startEvent)}animationFrame(e){if(this.elapsedTime+=e,this.elapsedTime>this.duration||0===this.duration){this.target.root.style.left=`${this.p1.x}px`,this.target.root.style.top=`${this.p1.y}px`,this.target.currentPosition=this.p1,this.target.SetOrientation(t.Zero),d.splice(d.findIndex(t=>t.id===this.id),1),this.target.dispatchEvent(this.endEvent);return}let n=this.elapsedTime/this.duration,i=this.rotationFactor,s=function(e,n){let i=e*e,s=i*e,r=3*s-6*i+3*e,o=-3*s+3*i,a=n.p1x*r+n.p2x*o+s,l=n.p1y*r+n.p2y*o+s;return new t(a,l)}(n,this.bezierParams),r=t.add(this.p0,this.travel.scale(s.y));this.target.root.style.left=`${r.x}px`,this.target.root.style.top=`${r.y}px`,this.target.currentPosition=r;// this.target.dispatchEvent(new CustomEvent('animationFrame'));
let o=(function(e,n){let i=e*e,s=9*i-12*e+3,r=-9*i+6*e,o=n.p1x*s+n.p2x*r+3*i,a=n.p1y*s+n.p2y*r+3*i;return new t(o,a)})(n,this.bezierParams).scale(i);this.target.SetOrientation(this.direction.scale(o.y))}stopAnimation(){let t=d.findIndex(t=>t.id===this.id);t<0||(d.splice(t,1),this.target.dispatchEvent(this.endEvent))}}function c(t,e){return n=>{let i=0,s=Number.MAX_VALUE;for(let r=0;r<n.length;++r){n[r].bounds.Recompute();let o=n[r].bounds.centerPosition.x-t,a=n[r].bounds.centerPosition.y-e,l=o*o+a*a;l<s&&(s=l,i=r)}return i}}window.addEventListener("load",()=>{!function(){let n=document.getElementById("game-board"),a=document.getElementById("card-root"),l=null;function d(n){let o=`PresentationCard${i()}`;n.classList.add(o);let a=document.querySelector(`.${o} #card`),l=document.querySelector(`.${o} #card-item`),d=document.querySelector(`.${o} #shine`),c=document.querySelector(`.${o} #shade`),m={lightDirection:new e(.15,-1,.25).normalize(),simHeight:190,lightPower:1.5,shadowDistance:5},u=function(t,n){let i=t.root;i.root=t.root;let o=t.zoomable,a={x:n.shadowDistance*e.dot(n.lightDirection,e.Left),y:n.shadowDistance*e.dot(n.lightDirection,e.Down)};t.cardItem.style.filter=`drop-shadow(${a.x}px ${a.y}px 5px black)`;let l=new e(-n.lightDirection.x,-n.lightDirection.y,n.lightDirection.z);i.SetPosition=t=>{i.lerpAnimator.stopAnimation(),i.root.style.left=`${t.x}px`,i.root.style.top=`${t.y}px`,i.currentPosition=t.clone()},i.SetOrientation=i=>{let s=Math.atan2(Math.abs(i.x),n.simHeight),r=0===i.x?0:i.x>0?s:-s,o=Math.atan2(Math.abs(i.y),n.simHeight),a=0===i.y?0:i.y>0?-o:o,d=function(t,n,i){let s=Math.cos(n),r=Math.sin(n),o=Math.cos(i),a=Math.sin(i);return new e(t.x*s+t.z*r,t.x*r*a+t.y*o-t.z*a*s,-t.x*r*o+t.y*a+t.z*s*o)}(e.Backward,r,a),h=Math.pow(e.dot(d,n.lightDirection),n.lightPower);t.cardItem.style.transform=`rotateY(${r}rad) rotateX(${a}rad)`,t.shine.style.opacity=`${100*h}%`;let c=Math.pow(e.dot(d,l),n.lightPower);t.shade.style.opacity=`${100*c}%`};let d=s({className:"zoomin",content:"transition: transform 0.25s ease-out;"});o.classList.add(d),i.SetZoom=t=>{o.style.transform=`scale(${t})`},i.SetSmoothOrientation=e=>{e?t.cardItem.classList.contains(d)||t.cardItem.classList.add(d):t.cardItem.classList.contains(d)&&t.cardItem.classList.remove(d)},i.lerpAnimator=new h(i,100);let c=new r(i);return i.currentPosition=c.centerPosition.clone(),i}({root:n,zoomable:a,cardItem:l,shine:d,shade:c},m);return u.SetOrientation(t.Zero),u}let m=d(a),u=null;function g(t){u=t,E.ContainsCard(t)&&(E.DetachCard(t),E.ReserveSlot(c(t.currentPosition.x,t.currentPosition.y)),l=E),t.style.zIndex="100",m.SetSmoothOrientation(!1)}function p(){u&&(u.style.zIndex="99",l&&l.AssignCardToReservation(u),u=null)}function y(t){t.root.addEventListener("mousedown",e=>{g(t)}),t.root.addEventListener("touchstart",t=>{let e=t.target;g(e)},!1),t.root.addEventListener("touchcancel",t=>{p()},!1),t.root.addEventListener("touchend",t=>{p()},!1)}y(m);let w=document.getElementById("test-button"),x=[document.getElementById("target-1"),document.getElementById("target-2"),document.getElementById("target-3"),document.getElementById("target-4")],f=0;function I(e,n,i){let s=new r(e.root),a=s.centerPosition,l=new t(n,i),d=t.sub(l,a).length(),h=(d-45)/135;h<0?h=0:h>1&&(h=1),// Applying a ramp
h*=h;// converting to speed
let c=1.9000000000000001*h+.8;e.lerpAnimator.startAnimation(a,l,c,o.Linear)}w.addEventListener("click",t=>{f=(f+1)%x.length;let e=new r(x[f]);m.lerpAnimator.startAnimation(m.currentPosition,e.centerPosition,.65,o.EaseInOut)}),n.addEventListener("mousemove",t=>{u&&I(u,t.clientX,t.clientY)}),n.addEventListener("touchmove",t=>{if(u){let e=t.targetTouches[0];I(u,e.clientX,e.clientY-150)}}),n.addEventListener("mouseup",()=>{p()});let v=[];for(let e=0;e<10;++e){let i=m.cloneNode(!0);n.appendChild(i);let s=d(i);s.lerpAnimator.startAnimation(s.currentPosition,t.add(s.currentPosition,new t(30*e,0)),.5,o.EaseInOut),y(s),v.push(s)}let C=document.getElementById("mock-collection"),E=function(t,e){t.itemPool=[],t.itemInUse=[],t.reservingItem=null,t.bounds=new r(t);let n="color:white;";e.itemStyle&&(n+=e.itemStyle);let i=s({className:"CardCollectionItem",content:n});for(let e=0;e<100;++e){let e=document.createElement("div");e.bounds=new r(e),e.classList.add(i),t.itemPool.push(e)}return t.ReserveSlot=e=>{if(t.reservingItem){let n=e(t.itemInUse),i=t.reservingItem.index;if(n!==i){if(n>i)for(let e=i;e<n;++e)t.itemInUse[e].assignedCard=t.itemInUse[e+1].assignedCard;else for(let e=i;e>n;--e)t.itemInUse[e].assignedCard=t.itemInUse[e-1].assignedCard;t.reservingItem=t.itemInUse[n],t.reservingItem.index=n,t.reservingItem.assignedCard=null,t.SlideAllCardsToAssignedItems()}}else{let n=t.itemPool.pop();t.appendChild(n),t.itemInUse.push(n);let i=e(t.itemInUse),s=t.itemInUse.length;for(let e=s-2;e>=i;--e)t.itemInUse[e+1].assignedCard=t.itemInUse[e].assignedCard;t.reservingItem=t.itemInUse[i],t.reservingItem.index=i,t.reservingItem.assignedCard=null,t.bounds.Recompute(),t.SlideAllCardsToAssignedItems()}},t.AssignCardToReservation=e=>{if(!t.reservingItem){console.warn("Trying to assign card but no slot reserved!");return}t.reservingItem.assignedCard=e,t.reservingItem.bounds.Recompute(),e.lerpAnimator.startAnimation(t.reservingItem.assignedCard.currentPosition,t.reservingItem.bounds.centerPosition,1,o.Linear),e.style.zIndex=t.reservingItem.index.toString(),t.reservingItem=null},t.CancelReservation=()=>{if(!t.reservingItem){console.warn("Cancelling but there is no reservation");return}t.removeChild(t.reservingItem),t.itemInUse.splice(t.reservingItem.index,1),t.reservingItem.assignedCard=null,t.reservingItem.index=-1,t.reservingItem.replaceChildren(),t.itemPool.push(t.reservingItem),t.reservingItem=null,t.SlideAllCardsToAssignedItems()},t.SlideAllCardsToAssignedItems=()=>{t.itemInUse.forEach((t,e)=>{t.assignedCard&&(t.bounds.Recompute(),new r(t.assignedCard),t.assignedCard.lerpAnimator.startAnimation(t.assignedCard.currentPosition,t.bounds.centerPosition,1,o.EaseInOut),t.assignedCard.style.zIndex=e.toString())})},t.ContainsCard=e=>void 0!==t.itemInUse.find(t=>t.assignedCard===e),t.DetachCard=e=>{let n=t.itemInUse.findIndex(t=>t.assignedCard===e);if(n<0){console.warn("detaching unkown card");return}t.removeChild(t.itemInUse[n]),t.itemInUse.splice(n,1),t.SlideAllCardsToAssignedItems()},t.InsertCardInstant=(e,n)=>{let i=t.itemPool.pop();t.itemInUse.splice(n,0,i),t.insertBefore(i,t.childNodes[n+1]),i.assignedCard=e,t.itemInUse.forEach(t=>{t.assignedCard&&(t.bounds.Recompute(),t.assignedCard.SetPosition(t.bounds.centerPosition))})},t.PushCardInstant=e=>{t.InsertCardInstant(e,t.itemInUse.length)},t}(C,{itemStyle:"width : 5em; height: 5em"});n.addEventListener("mousemove",e=>{let n=new t(e.clientX,e.clientY);E.bounds.Contains(n)?(E.reservingItem||(l=E),u&&E.ReserveSlot(c(e.clientX,e.clientY))):(l&&l.reservingItem&&l.CancelReservation(),l=null)}),v.forEach(t=>{E.PushCardInstant(t)})}()});//# sourceMappingURL=index.dfa0aa4b.js.map

//# sourceMappingURL=index.dfa0aa4b.js.map
