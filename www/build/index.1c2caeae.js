var t,e;class i{constructor(t,e){null===t?(this.x=0,this.y=0):(this.x=t,this.y=e)}clone(){return new i(this.x,this.y)}toString(){return`(${this.x}, ${this.y})`}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}normalize(){let t=this.length();return this.x=this.x/t,this.y=this.y/t,this}norm(){let t=this.length();return new i(this.x/t,this.y/t)}scale(t){return new i(this.x*t,this.y*t)}static dot(t,e){return t.x*e.x+t.y*e.y}static cross(t,e){return new n(0,0,t.x*e.y-t.y*e.x)}static add(t,e){return new i(t.x+e.x,t.y+e.y)}static sub(t,e){return new i(t.x-e.x,t.y-e.y)}static equal(t,e){return t.x===e.x&&t.y===e.y}}i.Zero=new i(0,0),i.Up=new i(0,1),i.Right=new i(1,0);class n{constructor(t,e,i){null===t?(this.x=0,this.y=0,this.z=0):(this.x=t,this.y=e,this.z=i)}toString(){return`(${this.x}, ${this.y}, ${this.z})`}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}normalize(){let t=this.length();return this.x=this.x/t,this.y=this.y/t,this.z=this.z/t,this}norm(){let t=this.length();return new n(this.x/t,this.y/t,this.z/t)}scale(t){return new n(this.x*t,this.y*t,this.z*t)}static dot(t,e){return t.x*e.x+t.y*e.y+t.z*e.z}static cross(t,e){return new n(t.y*e.z-t.z*e.y,t.z*e.x-t.x*e.z,t.x*e.y-t.y*e.x)}static add(t,e){return new n(t.x+e.x,t.y+e.y,t.z+e.z)}static sub(t,e){return new n(t.x-e.x,t.y-e.y,t.z-e.z)}static equal(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z}}n.Zero=new n(0,0,0),n.Up=new n(0,1,0),n.Down=new n(0,-1,0),n.Left=new n(-1,0,0),n.Right=new n(1,0,0),n.Forward=new n(0,0,-1),n.Backward=new n(0,0,1);let s=1;function r(){let t=`id-${s.toString(16)}`;return s+=1,t}function o(t){let e=`${t.className}-${r()}`;var i=document.createElement("style");return i.type="text/css",i.innerHTML=`${t.className?`.${e}`:""} ${t.id?`#${t.id}`:""} { ${t.content} }`,document.getElementsByTagName("head")[0].appendChild(i),e}class a{constructor(t){let e=t.getBoundingClientRect();this.targetElement=t,this.top=e.top+window.pageYOffset,this.right=e.right+window.pageXOffset,this.bottom=e.bottom+window.pageYOffset,this.left=e.left+window.pageXOffset,this.centerPosition=new i(e.left+window.pageXOffset+(e.right-e.left)/2,e.top+window.pageYOffset+(e.bottom-e.top)/2),this.width=e.right-e.left,this.height=e.top-e.bottom}Recompute(){let t=this.targetElement.getBoundingClientRect();this.top=t.top+window.pageYOffset,this.right=t.right+window.pageXOffset,this.bottom=t.bottom+window.pageYOffset,this.left=t.left+window.pageXOffset,this.centerPosition.x=t.left+window.pageXOffset+(t.right-t.left)/2,this.centerPosition.y=t.top+window.pageYOffset+(t.bottom-t.top)/2,this.width=t.right-t.left,this.height=t.top-t.bottom}Contains(t){return t.x>this.left&&t.x<this.right&&t.y>this.top&&t.y<this.bottom}}class l{}l.EaseInOut={p1x:.32,p1y:0,p2x:.5,p2y:1},l.Linear={p1x:.32,p1y:.32,p2x:.75,p2y:.75},l.DefaultBezierParams={p1x:.5,p1y:.5,p2x:.5,p2y:.5};let d=0,h=0;const m=[];!function t(e){let i=performance.now();h=i-d,d=i;for(let t=m.length-1;t>-1;--t){let e=m[t].AnimationFrame(h);e&&m.splice(t,1)}requestAnimationFrame(t)}(performance.now());class c{constructor(t){this.target=t,this.id=r(),this.startEvent=new CustomEvent("cardAnimationStart"),this.endEvent=new CustomEvent("cardAnimationEnd")}StopAnimation(){let t=m.findIndex(t=>t.id===this.id);t<0||(m.splice(t,1),this.target.dispatchEvent(this.endEvent))}AnimationFrame(t){throw Error("methode not implemented")}}class u extends c{constructor(t,e){super(t),this.rotationFactor=e,this.duration=0,this.p0=i.Zero.clone(),this.p1=i.Zero.clone(),this.travel=i.Zero.clone(),this.elapsedTime=0,this.startTime=-1,this.bezierParams=l.DefaultBezierParams,this.direction=i.Zero.clone(),this.id=r()}StartAnimation(t,e,n,s){this.p0=t.clone(),this.p1=e.clone();let r=i.sub(e,t).length();this.duration=r/n,this.startTime=performance.now()-h,this.elapsedTime=0,this.travel=i.sub(e,t),this.direction=this.travel.norm(),this.bezierParams=s,m.find(t=>t.id===this.id)||m.push(this),this.target.dispatchEvent(this.startEvent)}AnimationFrame(t){if(this.elapsedTime+=t,this.elapsedTime>this.duration||0===this.duration)return this.target.root.style.left=`${this.p1.x}px`,this.target.root.style.top=`${this.p1.y}px`,this.target.currentPosition=this.p1,this.target.LookToward(i.Zero),this.target.dispatchEvent(this.endEvent),!0;let e=this.elapsedTime/this.duration,n=this.rotationFactor,s=function(t,e){let n=t*t,s=n*t,r=3*s-6*n+3*t,o=-3*s+3*n,a=e.p1x*r+e.p2x*o+s,l=e.p1y*r+e.p2y*o+s;return new i(a,l)}(e,this.bezierParams),r=i.add(this.p0,this.travel.scale(s.y));this.target.root.style.left=`${r.x}px`,this.target.root.style.top=`${r.y}px`,this.target.currentPosition=r;// this.target.dispatchEvent(new CustomEvent('animationFrame'));
let o=(function(t,e){let n=t*t,s=9*n-12*t+3,r=-9*n+6*t,o=e.p1x*s+e.p2x*r+3*n,a=e.p1y*s+e.p2y*r+3*n;return new i(o,a)})(e,this.bezierParams).scale(n);return this.target.LookToward(this.direction.scale(o.y)),!1}}class g extends c{constructor(t){super(t),this.duration=0,this.endTime=0,this.startFaceDown=!1,this.elapsedTime=0}StartAnimation(t,e){this.duration=e;let i=performance.now()-h;this.endTime=i+e,this.elapsedTime=0,this.startFaceDown=t,m.find(t=>t.id===this.id)||m.push(this),this.target.dispatchEvent(this.startEvent)}AnimationFrame(t){if(this.elapsedTime+=t,this.target.isFlipped===this.startFaceDown&&this.elapsedTime>=this.duration/2&&this.target.SetFlip(!this.startFaceDown),this.elapsedTime>this.duration||0===this.duration)return this.target.dispatchEvent(this.endEvent),!0;// Animation time from 0 to 1
let e=this.elapsedTime/this.duration;return(// from 0 to .5 to 0 (at .5 the card is side way so invisible, finishing at 0 makes it so the content isn't mirrored)
e=.5-Math.abs(e-.5),this.target.SetRotation(e*Math.PI,0),!1)}}class p extends c{constructor(t,e,n){super(t),this.duration=n,this.elapsedTime=0,this.radius=e,this.circleCenter=i.Zero,this.startPosition=i.Zero,this.angleDelta=0,this.direction=1,this.targetZIndex=""}StartAnimation(t,e,n){this.elapsedTime=-t,m.find(t=>t.id===this.id)||m.push(this);let s=e*Math.PI*2;this.circleCenter=i.sub(this.target.currentPosition,new i(Math.sin(s),Math.cos(s)).scale(this.radius)),this.angleDelta=s,this.startPosition=this.target.currentPosition,this.target.dispatchEvent(this.startEvent),Math.random()>.5?this.direction=1:this.direction=-1,this.targetZIndex=n}AnimationFrame(t){if(this.elapsedTime+=t,this.elapsedTime>this.duration||0===this.duration)return this.target.SetPosition(this.startPosition),!0;if(this.elapsedTime<0)return!1;// Animation time from 0 to 1
let e=this.elapsedTime/this.duration;// Ease in out, t is still in the 0 1 range
e=(Math.sin((e-.5)*Math.PI)+1)/2,e*=e;let n=2*e*Math.PI*this.direction+this.angleDelta,s=i.add(this.circleCenter,new i(Math.sin(n),Math.cos(n)).scale(this.radius));return this.target.SetPosition(s),e>.5&&(this.target.style.zIndex=this.targetZIndex),!1}}function f(e,i){e.itemPool=[],e.itemInUse=[],e.reservingItem=null,e.bounds=new a(e);let n="color:white;";i.itemStyle&&(n+=i.itemStyle);let s=o({className:"CardCollectionItem",content:n});for(let t=0;t<100;++t){let t=document.createElement("div");t.bounds=new a(t),t.classList.add(s),e.itemPool.push(t)}return e.ReserveSlot=i=>{if(e.reservingItem){let n=i(e.itemInUse),s=e.reservingItem.index;if(n!==s){if(n>s)for(let t=s;t<n;++t)e.itemInUse[t].assignedCard=e.itemInUse[t+1].assignedCard;else for(let t=s;t>n;--t)e.itemInUse[t].assignedCard=e.itemInUse[t-1].assignedCard;return e.reservingItem=e.itemInUse[n],e.reservingItem.index=n,e.reservingItem.assignedCard=null,e.SlideAllCardsToAssignedItems(),t.Moved}}else{let n=e.itemPool.pop();e.appendChild(n),e.itemInUse.push(n);let s=i(e.itemInUse),r=e.itemInUse.length;for(let t=r-2;t>=s;--t)e.itemInUse[t+1].assignedCard=e.itemInUse[t].assignedCard;return e.reservingItem=e.itemInUse[s],e.reservingItem.index=s,e.reservingItem.assignedCard=null,e.bounds.Recompute(),e.SlideAllCardsToAssignedItems(),t.New}return t.Same},e.AssignCardToReservation=t=>{if(!e.reservingItem){console.warn("Trying to assign card but no slot reserved!");return}e.reservingItem.assignedCard=t,e.reservingItem.bounds.Recompute(),t.lerpAnimator.StartAnimation(e.reservingItem.assignedCard.currentPosition,e.reservingItem.bounds.centerPosition,1,l.Linear),t.style.zIndex=e.reservingItem.index.toString(),e.reservingItem=null},e.CancelReservation=()=>{if(!e.reservingItem){console.warn("Cancelling but there is no reservation");return}e.removeChild(e.reservingItem),e.itemInUse.splice(e.reservingItem.index,1),e.reservingItem.assignedCard=null,e.reservingItem.index=-1,e.reservingItem.replaceChildren(),e.itemPool.push(e.reservingItem),e.reservingItem=null,e.SlideAllCardsToAssignedItems()},e.SlideAllCardsToAssignedItems=()=>{e.itemInUse.forEach((t,e)=>{t.assignedCard&&(t.bounds.Recompute(),new a(t.assignedCard),t.assignedCard.lerpAnimator.StartAnimation(t.assignedCard.currentPosition,t.bounds.centerPosition,1,l.EaseInOut),t.assignedCard.style.zIndex=e.toString())})},e.ContainsCard=t=>void 0!==e.itemInUse.find(e=>e.assignedCard===t),e.DetachCard=t=>{let i=e.itemInUse.findIndex(e=>e.assignedCard===t);if(i<0){console.warn("detaching unkown card");return}e.removeChild(e.itemInUse[i]),e.itemInUse.splice(i,1),e.SlideAllCardsToAssignedItems();let n=new CustomEvent("card-detach",{detail:{card:t}});e.dispatchEvent(n)},e.InsertCardInstant=(t,i)=>{let n=e.itemPool.pop();e.itemInUse.splice(i,0,n),e.insertBefore(n,e.childNodes[i+1]),n.assignedCard=t,e.bounds.Recompute(),e.itemInUse.forEach(t=>{t.assignedCard&&(t.bounds.Recompute(),t.assignedCard.SetPosition(t.bounds.centerPosition))})},e.PushCardInstant=t=>{e.InsertCardInstant(t,e.itemInUse.length)},e}function y(t,e){return i=>{let n=0,s=Number.MAX_VALUE;for(let r=0;r<i.length;++r){i[r].bounds.Recompute();let o=i[r].bounds.centerPosition.x-t,a=i[r].bounds.centerPosition.y-e,l=o*o+a*a;l<s&&(s=l,n=r)}return n}}(e=t||(t={}))[e.New=0]="New",e[e.Moved=1]="Moved",e[e.Same=2]="Same",window.addEventListener("load",()=>{!function(){var e,s,d;let h=document.getElementById("game-board"),m=document.getElementById("card-root"),c=null,w=Array.from(document.getElementsByClassName("flip-sfx")).map(t=>t);function I(t){let e=`PresentationCard${r()}`;t.classList.add(e);let s={lightDirection:new n(.15,-1,.25).normalize(),simHeight:190,lightPower:1.5,shadowDistance:5},l=function(t,e){t.root=t,t.frontItems=Array.from(t.getElementsByClassName("front")).map(t=>t),t.backItems=Array.from(t.getElementsByClassName("back")).map(t=>t),t.shadeItems=Array.from(t.getElementsByClassName("shade")).map(t=>t),t.shineItems=Array.from(t.getElementsByClassName("shine")).map(t=>t);{let e=Array.from(t.getElementsByClassName("card-item")).map(t=>t);if(1!==e.length)throw'wrong number of element with class "card-item"';t.cardItem=e.pop()}{let e=Array.from(t.getElementsByClassName("zoom-item")).map(t=>t);if(1!==e.length)throw'wrong number of element with class "zoom-item"';t.zoomElement=e.pop()}t.isFlipped=!1;let i={x:e.shadowDistance*n.dot(e.lightDirection,n.Left),y:e.shadowDistance*n.dot(e.lightDirection,n.Down)};t.cardItem.style.filter=`drop-shadow(${i.x}px ${i.y}px 5px black)`;let s=new n(-e.lightDirection.x,-e.lightDirection.y,e.lightDirection.z);t.SetPosition=e=>{t.lerpAnimator.StopAnimation(),t.root.style.left=`${e.x}px`,t.root.style.top=`${e.y}px`,t.currentPosition=e.clone()},t.LookToward=i=>{let n=Math.atan2(Math.abs(i.x),e.simHeight),s=0===i.x?0:i.x>0?n:-n,r=Math.atan2(Math.abs(i.y),e.simHeight),o=0===i.y?0:i.y>0?-r:r;t.SetRotation(s,o)},t.SetRotation=(i,r)=>{// Rotating a vector up toward the viewer to the inclination of the card.
let o=function(t,e,i){let s=Math.cos(e),r=Math.sin(e),o=Math.cos(i),a=Math.sin(i);return new n(t.x*s+t.z*r,t.x*r*a+t.y*o-t.z*a*s,-t.x*r*o+t.y*a+t.z*s*o)}(n.Backward,i,r),a=Math.pow(n.dot(o,e.lightDirection),e.lightPower);t.cardItem.style.transform=`rotateY(${i}rad) rotateX(${r}rad)`;for(let e=0;e<t.shineItems.length;++e)t.shineItems[e].style.opacity=`${100*a}%`;let l=Math.pow(n.dot(o,s),e.lightPower);for(let e=0;e<t.shadeItems.length;++e)t.shadeItems[e].style.opacity=`${100*l}%`};let r=o({className:"zoomin",content:"transition: transform 0.25s ease-out;"});t.zoomElement.classList.add(r),t.SetZoom=e=>{t.zoomElement.style.transform=`scale(${e})`},t.SetSmoothOrientation=e=>{e?t.cardItem.classList.contains(r)||t.cardItem.classList.add(r):t.cardItem.classList.contains(r)&&t.cardItem.classList.remove(r)},t.SetFlip=e=>{for(let i=0;i<t.frontItems.length;++i)t.frontItems[i].style.display=e?"none":"";for(let i=0;i<t.backItems.length;++i)t.backItems[i].style.display=e?"":"none";t.isFlipped=e},t.AnimatedFlip=e=>{t.isFlipped!==e&&t.flipAnimator.StartAnimation(t.isFlipped,750)},t.lerpAnimator=new u(t,100),t.flipAnimator=new g(t);let l=new a(t);return t.currentPosition=l.centerPosition.clone(),t.SetFlip(!1),t.circlingAnimation=new p(t,30,1e3),t}(t,s);return l.LookToward(i.Zero),l}let x=I(m),v=null;function C(t){v=t,c&&c.ContainsCard(t)&&(c.DetachCard(t),c.ReserveSlot(y(t.currentPosition.x,t.currentPosition.y))),t.style.zIndex="100",x.SetSmoothOrientation(!1)}function E(){v&&(v.style.zIndex="99",c&&c.AssignCardToReservation(v),v=null)}function A(t){t.root.addEventListener("mousedown",e=>{C(t)}),t.root.addEventListener("touchstart",t=>{let e=t.target;C(e)},!1),t.root.addEventListener("touchcancel",t=>{E()},!1),t.root.addEventListener("touchend",t=>{E()},!1)}function b(){let t=Math.floor(Math.random()*w.length);w[t].play()}A(x);let P=document.getElementById("slide-button"),S=document.getElementById("slide-test").getElementsByClassName("target"),z=0;function T(t,e,n){let s=new a(t.root),r=s.centerPosition,o=new i(e,n),d=i.sub(o,r).length(),h=(d-45)/135;h<0?h=0:h>1&&(h=1),// Applying a ramp
h*=h;// converting to speed
let m=1.9000000000000001*h+.8;t.lerpAnimator.StartAnimation(r,o,m,l.Linear)}P.addEventListener("click",t=>{z=(z+1)%S.length;let e=new a(S.item(z));M.forEach(t=>{t.ContainsCard(x)&&t.DetachCard(x)}),x.lerpAnimator.StartAnimation(x.currentPosition,e.centerPosition,.65,l.EaseInOut)}),h.addEventListener("mousemove",t=>{v&&T(v,t.clientX,t.clientY)}),h.addEventListener("touchmove",t=>{if(v){let e=t.targetTouches[0];T(v,e.clientX,e.clientY-150)}}),h.addEventListener("mouseup",()=>{E()});let L=[];for(let t=0;t<10;++t){let e=x.cloneNode(!0);h.appendChild(e);let n=I(e);n.lerpAnimator.StartAnimation(n.currentPosition,i.add(n.currentPosition,new i(30*t,0)),.5,l.EaseInOut),A(n),L.push(n)}let U={itemStyle:"width : 5em; height: 5em"},M=[],B=document.getElementsByClassName("card-collection");for(let t=0;t<B.length;++t){let e=B.item(t);M.push(f(e,U))}h.addEventListener("mousemove",e=>{let n=new i(e.clientX,e.clientY),s=null;for(let t=0;t<M.length;++t){let e=M[t];if(e.bounds.Contains(n)){s=e;break}}if(s!==c&&(c&&c.reservingItem&&(c.CancelReservation(),b()),c=s),s&&v){let i=s.ReserveSlot(y(e.clientX,e.clientY));i===t.New&&b()}});{let t=document.getElementById("mock-collection");L.forEach(e=>{t.PushCardInstant(e)})}{let t=document.getElementById("flip-collection");null===(e=document.getElementById("flip-button"))||void 0===e||e.addEventListener("click",e=>{t.itemInUse.forEach(t=>{t.assignedCard&&(t.assignedCard.AnimatedFlip(!t.assignedCard.isFlipped),b())})})}{let t=document.getElementById("zoom-collection"),e=[];null===(s=document.getElementById("zoom-button"))||void 0===s||s.addEventListener("click",i=>{t.itemInUse.forEach(t=>{t.assignedCard&&(t.assignedCard.SetZoom(2),e.push(t.assignedCard))})}),t.addEventListener("card-detach",t=>{t.detail.card.SetZoom(1),e.splice(e.findIndex(e=>e.id===t.detail.card.id),1)}),h.addEventListener("mousemove",t=>{e&&e.forEach(e=>{let n=i.sub(new i(t.clientX,t.clientY),e.currentPosition).scale(.5);e.LookToward(n)})})}{let t=document.getElementById("shuffle-collection"),e=function(t,e){let i=f(t,e);return i.ShuffleAnimation=()=>{var t;if(!(i.itemInUse.length<1)){i.itemInUse.splice(0,0,i.itemInUse.pop());for(let e=0;e<i.itemInUse.length;++e){let n=e/i.itemInUse.length,s=100*n,r=e;null===(t=i.itemInUse[e].assignedCard)||void 0===t||t.circlingAnimation.StartAnimation(s,n,r.toString())}}},i}(t,{});M.push(e),null===(d=document.getElementById("shuffle-button"))||void 0===d||d.addEventListener("click",t=>{e.ShuffleAnimation()})}}()});//# sourceMappingURL=index.1c2caeae.js.map

//# sourceMappingURL=index.1c2caeae.js.map
